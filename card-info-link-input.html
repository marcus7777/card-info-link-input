<link rel="import" href="../image-base64/image-base64.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../url-encode/url-encode.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<!--
  `<card-info-link-input></card-info-link-input>` 
  @demo demo.html
-->
<dom-module id="card-info-link-input">
  <template>
    <style>
      :host {display:inline-block;background:#fff}
    </style>
    <paper-input label="[[label]]" value="{{url}}" invalid="{{invalid}}" auto-validate  pattern="(\b(https?)://)[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]">
    </paper-input>
    <template is="dom-if" if="[[url]]" restamp>
      <url-encode input="[[url]]" out="{{out}}"></url-encode>
      <iron-ajax auto url="https://info.open-elements.org/url/[[out]]" handle-as="json" last-response="{{value}}"></iron-ajax>
      <template is="dom-if" if="[[value.cardIcon]]">
        <image-base64 url="[[value.cardIcon]]" base64="{{img}}" width="200" ></image-base64>
        <center><img src="[[img]]" /></center>
      </template>
      <h3>[[value.title]]</h3>
      <h4>[[value.desc ]]</h4>
      <h5>[[value.link ]]</h5>
    </template>
  </template>
</dom-module>
<script>
  Polymer({
    is: "card-info-link-input",
    properties:{
      value:{
        notify:true,
      },
      restamp: {
        computed:"restampMe(url,invalid)"
      }
    },
    restampMe: function(url,invalid){
      if (url) {
        if (!invalid) {
          this.async(this.restampMe,100)
        }
        return false
      } else {
        return true
      }
    },
    attached: function(){
      if (this.value) {
        if (this.value.link) {
          this.url = this.value.link
        }
      }
    }
  })
</script>
